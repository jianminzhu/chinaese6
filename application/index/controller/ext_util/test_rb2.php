<?php
require_once 'rb.php';
require_once "fileUtil.php";
function save($tableName, $data)
{
    try {
        $to = R::dispense($tableName);
        foreach ($data as $key => $value) {
            $to[$key] = $value;
        }
        return R::store($to);
    } catch (Exception $e) {
        print "\nerror in " . $e->getMessage();
        return null;
    }
}

function findSave($tablename, $data)
{
    try {
        return R::findOrCreate($tablename, $data);
    } catch (Exception $e) {
        print "error in " . $e->getMessage();
        return null;
    }
}

function c($id)
{
    if ($id) {
        $header = ["Host: www.bytrip.com"
            , "Connection: keep-alive"
            , "Accept: */*"
            , "X-Requested-With: XMLHttpRequest"
            , "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3710.0 Safari/537.36"
            , "Referer: http://www.bytrip.com/i/u_$id.html"
            , "Accept-Encoding: gzip, deflate"
            , "Accept-Language: zh-CN,zh;q=0.9"
            , "Cookie: userAgent=windows; UM_distinctid=16951d8cc6e351-0f58a4b9eda2e8-65507628-100200-16951d8cc6f46a; pgv_pvi=8289512448; _qddaz=QD.rrg62g.l31xa0.jswv7gs5; tencentSig=3543160832; PHPSESSID=upj15ipsojakf8304jn023m2f0; Hm_lvt_c4cdd73c3369f00bb9e8b9dcaeef9374=1552458350,1552468655,1552631899,1552707193; IESESSION=alive; pgv_si=s5936715776; onethink_home_befor_login=http%3A%2F%2Fwww.bytrip.com%2FUser%2FPublic%2Floginout.html; CNZZDATA1264312706=276594731-1551852564-%7C1552746882; _qdda=3-1.1; _qddab=3-s3qu7y.jtbmbd4y; _qddamta_800001973=3-0; onethink_home__userinfo=think%3A%7B%22uid%22%3A%22170712%22%2C%22nickname%22%3A%22considerateman%22%2C%22realname%22%3A%22%25E4%25BD%2593%25E8%25B4%25B4%25E7%2594%25B7%22%2C%22hx_password%22%3A%22f65c5248dc230b9cedee77296f266c05%22%2C%22hx_username%22%3A%2253d25555eddc73436fa0c0a842663574%22%2C%22birthday%22%3A%221966-1-10%22%2C%22sex%22%3A%221%22%2C%22address_city%22%3A%22110100%22%2C%22address_province%22%3A%22110000%22%2C%22height%22%3A%22180%22%2C%22weight%22%3A%2270%22%2C%22bwh%22%3A%22%25E8%2585%25B0%25E5%259B%25B4%22%2C%22marriage%22%3A%224%22%2C%22education%22%3A%22%25E7%25A1%2595%25E5%25A3%25AB%22%2C%22profession%22%3A%223%22%2C%22language%22%3A%221%252C2%252C3%252C7%22%2C%22mood%22%3A%22%25E6%2588%2591%25E7%25BB%258F%25E5%25B8%25B8%25E5%2587%25BA%25E5%25B7%25AE%25EF%25BC%258C%25E7%25BE%258E%25E5%259B%25BD%25EF%25BC%258C%25E5%258A%25A0%25E6%258B%25BF%25E5%25A4%25A7%25EF%25BC%258C%25E4%25B8%258A%25E6%25B5%25B7%252C%25E5%258C%2597%25E4%25BA%25AC%25EF%25BC%258C%25E6%259D%25AD%25E5%25B7%259E%25E8%25A5%25BF%25E5%25AE%2589%25E9%2587%258D%25E5%25BA%2586%25EF%25BC%258C%25E8%25BF%2598%25E6%259C%2589%25E5%2585%25A8%25E5%259B%25BD%25E5%2585%25B6%25E4%25BB%2596%25E5%2590%2584%25E5%259C%25B0%25E3%2580%2582%25E6%2583%25B3%25E6%2589%25BE%25E7%25B4%25A0%25E8%25B4%25A8%25E5%25A5%25BD%25EF%25BC%258C%25E6%259C%2589%25E4%25BF%25AE%25E5%2585%25BB%25EF%25BC%258C%25E6%2580%25A7%25E6%2583%2585%25E6%259F%2594%25E5%2592%258C%25E7%259A%2584%25E4%25BC%25B4%25E6%25B8%25B8%25E3%2580%2582%25E6%259C%2589%25E6%2597%25B6%25E4%25B8%2580%25E4%25BA%25BA%25E5%25AF%2582%25E5%25AF%259E%25EF%25BC%258C%25E5%25B8%258C%25E6%259C%259B%25E4%25BC%25B4%25E6%25B8%25B8%25E9%2599%25AA%25E6%2588%2591%25E5%2590%2583%25E5%2590%2583%25E9%25A5%25AD%25EF%25BC%258C%25E8%2581%258A%25E8%2581%258A%25E5%25A4%25A9%25EF%25BC%258C%25E5%258F%25A6%25E5%25A4%2596%25E5%258E%25BB%25E6%2599%25AF%25E7%2582%25B9%25E7%259A%2584%25E6%2597%25B6%25E5%2580%2599%25E6%259C%2580%25E5%25A5%25BD%25E8%2583%25BD%25E8%25AE%25B2%25E4%25BA%259B%25E5%2586%2585%25E5%25AE%25B9%25E3%2580%2582%25E8%25B4%25B9%25E7%2594%25A8%25E4%25B8%258D%25E6%2598%25AF%25E9%2597%25AE%25E9%25A2%2598%25E3%2580%2582%22%2C%22experience%22%3A%220%22%2C%22temperament%22%3A%22%252C6%252C2%22%2C%22speciality%22%3A%22%22%2C%22isapprove%22%3A%223%22%2C%22type%22%3A%221%22%2C%22money%22%3A%220.00%22%2C%22account%22%3A%220.00%22%2C%22score%22%3A%220%22%2C%22giftbox%22%3A%2230%22%2C%22flower%22%3A%220%22%2C%22vip%22%3A%2212%22%2C%22overdue_time%22%3A%221577342626%22%2C%22login%22%3A%2265%22%2C%22reg_ip%22%3A%220%22%2C%22reg_time%22%3A%221347271260%22%2C%22last_login_ip%22%3A%221779329066%22%2C%22last_login_time%22%3A%221552749277%22%2C%22status%22%3A%221%22%2C%22travel_status%22%3A%220%22%2C%22updatetime%22%3A%220%22%2C%22video%22%3A%220%22%2C%22approve_type%22%3A%220%22%2C%22isfull%22%3A%221%22%2C%22price%22%3A%221.00%22%2C%22login_type%22%3A%223%22%2C%22hot%22%3A%2297%22%2C%22is_tan%22%3A%223%22%2C%22zskf%22%3A%229%22%2C%22htkt_time%22%3A%220%22%2C%22is_read%22%3A%220%22%2C%22is_recommend%22%3A%220%22%2C%22face_img%22%3A%2255432%22%2C%22link_time%22%3A%22%22%2C%22index_sort%22%3A%220%22%2C%22is_apply%22%3A%220%22%2C%22gid%22%3A%22%22%2C%22pos_top%22%3A%220%22%2C%22journey_num%22%3A%220%22%2C%22online_lover_num%22%3A%220%22%2C%22video_num%22%3A%220%22%2C%22tourist_price%22%3A%220.00%22%2C%22cus_num%22%3A%220%22%2C%22video_banyou_num%22%3A%220%22%2C%22video_mm_num%22%3A%220%22%2C%22free_date%22%3A%220%22%2C%22rtime%22%3A%220%22%2C%22sort%22%3A%220%22%2C%22pid%22%3A%220%22%2C%22setting%22%3A%22%22%2C%22_face%22%3A%2255432%22%7D; Hm_lpvt_c4cdd73c3369f00bb9e8b9dcaeef9374=1552749376"
        ];
        $sjson = ExtGetJson("http://www.bytrip.com/User/Ajax/swapContact.html?id=$id", $header);
        return ExtGetJson("http://www.bytrip.com/User/Ajax/contact.html?fuid=$id", $header);

    }
    return null;
}


//$jsonStr =file_get_contents("./test_rb2.json");
R::setup("mysql:host=localhost;dbname=test", "root", "root");
$ids=[273,365,690,997,1867,1987,1988,2535,2838,2945,2960,3034,3065,3196,3354,3433,3459,3511,3821,3840,4071,4413,4636,5064,5135,5142,5161,5184,5197,5208,5252,5258,5302,5323,5400,5460,5468,5521,5525,5533,5599,5622,5627,5693,5694,5747,5749,5770,5823,5831,5993,6007,6047,6229,6252,6253,6254,6343,6488,6532,6577,6622,6658,6702,6761,6888,6978,7037,7218,7230,7346,7715,8026,8165,8196,8350,8357,8506,9294,9523,9558,9592,9770,9936,9937,9997,10158,10282,10378,10450,10604,10813,10968,11953,11970,12030,12134,12166,12168,12216,12317,12468,12633,12702,12734,13058,13361,13905,13912,13913,14033,14058,14322,14365,14416,14494,14546,14554,14639,14641,14782,14853,15035,15043,15065,15074,15226,15239,15406,15411,15560,15646,15951,15984,16037,16053,16110,16502,16695,16707,16740,17042,17190,17232,17401,17498,17603,17858,18009,18090,18546,18671,18744,18933,18956,19059,19376,19558,20312,20460,20520,20616,20647,20702,20720,21116,21433,21541,21727,21908,22060,22125,22128,22135,22155,22216,22243,22294,22320,22324,22362,22399,22408,22420,22431,22447,22454,22463,22524,22546,22576,22643,22680,22778,23379,23418,23448,23517,23713,23725,23765,23841,23994,24218,24397,24573,24597,25230,25336,25431,25494,25792,26189,26901,26926,26933,26939,26962,27145,27154,27214,27316,27317,27358,27388,27644,27707,27733,27746,27793,27870,28001,28300,28707,28729,28785,28806,28834,29013,29087,29088,29223,29300,29413,29414,29461,29476,29664,29674,29691,29765,29775,29806,29908,29912,29928,30029,30037,30077,30085,30124,30182,30336,30490,30492,30524,31116,31768,32515,32690,32985,33027,33184,33434,33545,33699,34202,34262,34423,34568,34592,34636,34713,34946,35049,35373,35520,35565,35595,35797,36169,36695,36734,36798,37167,37621,37676,37844,38076,38162,38299,38403,38404,38498,38500,38523,38577,38673,38958,38972,38984,39031,39144,39232,39250,39370,39407,39434,39478,39556,39704,39813,39820,39962,40174,40337,40362,40562,40679,40993,41163,41205,41254,41383,41550,41662,41868,42013,42063,42245,42473,42498,42710,42983,43088,43131,43182,43339,43507,43595,43731,43787,43809,43824,43937,44595,44718,44853,44956,45015,45084,45138,45226,45542,45565,45963,45975,46268,46348,46631,46718,46731,46950,47001,47083,47177,47200,47201,47202,47233,47235,47330,47689,47709,47829,47850,47905,48010,48096,48267,48310,48679,48910,48913,49051,49245,49737,49808,49838,50114,50209,50264,50471,50575,50639,50680,50797,50832,50868,51022,51213,51505,51655,51876,51941,51968,52264,52418,53045,53273,53680,53788,53835,54272,54354,54441,54456,54575,54631,54835,54874,54886,55011,55287,55371,55925,56099,56300,56320,56329,56431,56509,56510,56539,56540,56544,56597,56611,56702,56719,57106,57159,57284,57439,57488,57489,57564,57648,57703,57738,57821,57841,57953,58042,58115,58253,58388,58494,58605,58619,58892,59047,59084,59195,59221,59418,59668,59703,59799,59996,60122,60278,60770,60861,60898,61136,61178,61250,61360,61662,61680,61705,61710,61782,62003,62026,62165,62357,62430,62610,62769,62943,63068,63114,63206,63259,63267,63330,63373,63393,63395,63407,63433,63524,63857,63858,64253,64502,64518,64764,64775,64795,64972,64982,65325,65482,65790,65914,65924,66037,66059,66313,66528,66614,66753,67221,67767,67986,68084,68190,68203,68365,68546,68656,69002,69006,69072,69094,69103,69176,69393,69477,69558,70012,70057,70061,70077,70115,70238,70314,70375,70420,70464,70547,70553,70638,70676,70685,70686,70696,70721,70842,71030,71073,71084,71114,71163,71175,71318,71388,71543,71649,71673,71676,71943,72206,72382,72412,72524,72656,72795,73034,73124,73571,73819,74313,74395,74484,74761,74914,74920,75295,75469,75557,75580,75644,75665,75721,75736,75886,75896,75914,76079,76120,76162,76275,76397,76489,76592,76666,76732,76746,76818,76840,77038,77107,77138,77141,77293,77388,77453,77475,77547,77609,77645,77819,77972,78022,78101,78187,78348,78527,78539,78564,78844,78999,79042,79058,79223,79258,79824,80005,80364,80385,80447,80524,80590,80649,80830,80947,81103,81356,81596,81878,82189,82363,82400,82479,82666,83095,83099,83101,83157,83180,83250,83290,83300,83331,83378,83524,83525,83574,83738,83889,84075,84091,84238,84271,84327,84328,84372,84390,84427,84469,84559,84630,84634,84671,84742,84813,84825,85027,85097,85125,85393,85557,85575,85632,85870,86202,86351,86397,86454,86531,86618,86654,86744,86748,86954,87113,87175,87258,87356,87452,87646,87725,87790,88133,88239,88654,89002,89028,89049,89061,89282,89356,89396,89416,89434,89556,89572,89628,89695,89801,89879,89975,90045,90103,90342,90375,90450,90760,91000,91011,91017,91168,91294,91848,91941,91959,92193,92211,92222,92273,92330,92417,92576,92595,92616,92680,93080,93186,93563,93799,93851,93987,95053,95058,95545,95579,95882,95911,96014,96043,96272,96290,96298,96400,96561,96737,96820,96850,97136,97255,97278,97285,97664,97739,97754,97781,97827,97859,97938,98115,98132,98435,98511,98546,98765,98787,98919,99001,99199,99365,99380,99447,99523,99612,99790,99989,100088,100180,100258,100273,100709,100758,100797,100887,100958,101034,101149,101231,101251,101264,101283,101450,101593,101603,101902,102003,102080,102193,102196,102221,102559,102568,102725,102756,102848,103547,103610,103653,103668,103734,103922,103937,104179,104230,104260,104270,104283,104501,104601,104817,104827,104859,105237,105428,105589,106030,106182,106277,106359,106424,106450,106485,106498,106560,106681,106817,106822,106875,106929,107149,107350,107580,107582,107654,107906,107970,108008,108243,108438,108450,108622,108676,108756,108888,109043,109140,109341,109352,109556,109881,109918,110213,110219,110332,110378,110403,111197,111219,111377,111496,111527,111920,111987,111988,112207,112246,112358,112412,112730,112910,112965,113115,113459,113497,113615,113729,113826,113828,114060,114219,114306,114375,114486,114539,114694,114783,114941,114947,116692,116726,116787,116816,116860,116878,116888,116928,117027,117300,117386,117419,117445,117500,117575,117696,117747,117764,117826,117847,118054,118112,118184,118190,118256,118875,119113,119358,119782,119939,119980,120013,120476,120594,120664,120688,120694,120720,120878,121045,121091,121093,121229,121270,121332,121350,121468,121488,121542,121560,121591,121669,121727,121957,122126,122229,122402,122468];
$ids = [365, 690, 1988, 2838, 3354, 3433, 3511, 3821, 3840, 4071, 4413, 4636, 5135, 5142, 5161, 5184, 5197, 5252, 5258, 5400, 5460, 5468, 5521, 5525, 5533, 5622, 5823, 5831, 6229, 6252, 6253, 6577, 6658, 6761, 6888, 7037, 7218, 8350, 9770, 9997, 10378, 10450, 10604, 10968, 11970, 12166, 12216, 12468, 12702, 13905, 13913, 14058, 14365, 14546, 14782, 14853, 15035, 15043, 15074, 15226, 15406, 15951, 16053, 16502, 16707, 17190, 17232, 20460, 20702, 21116, 21727, 22125, 22128, 22155, 22216, 22243, 22294, 22362, 22408, 22431, 22454, 22463, 22524, 22546, 22576, 23379, 23448, 23713, 23725, 23841, 23994, 25336, 26189, 26926, 27145, 27154, 27388, 28707, 28834, 29013, 29223, 29461, 29476, 29664, 29674, 29691, 29765, 29908, 29928, 30029, 30037, 30182, 30490, 30524, 32515, 34202, 34568, 34592, 34636, 35520, 35565, 35595, 36169, 36695, 37621, 37676, 38076, 38299, 38403, 38404, 38500, 38523, 38577, 38673, 38972, 38984, 39232, 39434, 39556, 39962, 40993, 41163, 41254, 41868, 42013, 42063, 43131, 43339, 43731, 45015, 45565, 46268, 46718, 47083, 47200, 47201, 47202, 47233, 47235, 47829, 47850, 48267, 49808, 49838, 50114, 50471, 50680, 50832, 51022, 51213, 52264, 53273, 53680, 53835, 54272, 54354, 54441, 54631, 54835, 54874, 55011, 56099, 56329, 56509, 56539, 56544, 56597, 56611, 56719, 57564, 57738, 57821, 57953, 58494, 58892, 59668, 59799, 59996, 60122, 60770, 61136, 61250, 61662, 61705, 62003, 62026, 62165, 62430, 62610, 62769, 63259, 63393, 63395, 63433, 63524, 63857, 63858, 64518, 64764, 64775, 64972, 66059, 66614, 68546, 69002, 69006, 69094, 69558, 70061, 70115, 70238, 70314, 70464, 70676, 70685, 70686, 70721, 70842, 71030, 71073, 71175, 71318, 71673, 71676, 71943, 72382, 72524, 73124, 74395, 74920, 75295, 75557, 75886, 75896, 76079, 76162, 76275, 76397, 76489, 76666, 76746, 77107, 77138, 77141, 77388, 77475, 77609, 77819, 78187, 78527, 78564, 78844, 78999, 79058, 80447, 80524, 80590, 80649, 81596, 81878, 82363, 82666, 83099, 83101, 83157, 83300, 83524, 83525, 84075, 84238, 84328, 84427, 84469, 84630, 85097, 85393, 86748, 87113, 87452, 87646, 89061, 89282, 89356, 89434, 89572, 89801, 89879, 89975, 90045, 90342, 90450, 90760, 91011, 91017, 91941, 91959, 92417, 92576, 92680, 93080, 93186, 93799, 96298, 96400];
echo count($ids);
$ids=[ 96737, 96850, 97255, 97278, 97859, 98546, 98765, 98919, 99001, 99612, 100180, 101034, 101251, 101283, 101593, 101902, 102193, 102196, 102756, 103610, 103668, 103922, 103937, 104179, 104260, 104270, 104601, 104817, 105589, 106030, 106277, 106359, 106681, 106817, 108008, 108243, 108676, 109556, 109881, 110219, 110378, 110403, 112358, 112730, 113115, 113459, 114306, 114486, 114539, 114783, 114941, 116860, 116878, 117300, 117500, 117696, 117747, 117764, 118184, 118190, 119358, 119782, 119980, 120013, 120476, 120664, 120694, 121091, 121093, 121229, 121332, 121350, 121468, 121488, 121560, 121591, 121727, 121957, 122994, 123206, 123933, 123981, 123984, 124006, 124221, 124484, 124612, 125931, 126202, 126424, 126620, 126654, 127207, 127576, 127623, 127969, 128436, 128735, 128808, 129143, 129456, 129582, 129686, 130683, 131098, 131512, 131786, 131974, 132077, 132453, 132502, 132563, 132574, 132581, 132648, 132781, 133070, 133577, 133626, 134495, 134585, 135073, 135172, 135209, 136692, 137794, 138028, 138212, 139412, 139957, 140347, 140458, 140547, 140742, 141067, 141222, 141673, 141852, 142148, 142653, 142868, 143148, 144135, 144275, 146321, 146781, 147026, 147100, 147246, 147356, 147519, 147542, 147573, 147723, 147807, 147829, 147830, 147839, 148348];
$ids=[ 148950, 149175, 149263, 149500, 149798, 151257, 151349, 151407, 151476, 152085, 152175, 152181, 152201, 152208, 152391, 154848, 154884, 154898, 155065, 155571, 155654, 155950, 156021, 156047, 156100, 156212, 156277, 156422, 156576, 156579, 156580, 156646, 156680, 157248, 157322, 157622, 157756, 157989, 158360, 158486, 158490, 158491, 158540];

$ids=[158569, 158590, 158675, 158752, 158848, 158982, 159021, 159033, 159040, 159884, 160377, 160468, 160503, 161230, 161372, 161913, 165795, 166320, 168044, 168308, 168751, 168759, 168795, 168862, 169059, 169163, 169172, 169252, 169291, 169354, 169520, 171194, 171458, 171507, 172050, 172267, 172365, 172659, 172965, 173517, 173733, 173854, 173966, 174595, 176967, 177108, 177286, 177453, 177660, 178500, 178834, 179340, 179550, 179663, 179734, 181261, 181385, 181538, 181987, 182193, 182908, 183112, 183416, 183604, 183687, 183742, 184026, 184193, 184302, 184426, 184520, 184635, 184882, 185420, 185776, 186318, 186418, 186450, 186684, 186776, 186800, 186914, 186922, 186950, 187009, 187537, 188050, 188181, 188458, 189507, 189673, 189861, 190260, 190302, 190702, 190840, 192796, 193605, 193657, 193724, 193769, 193793, 193841, 193868, 193869, 193885, 193897, 193927, 193951, 194008, 194009, 194016, 194017, 194063, 194161, 194179, 194395, 195041, 195333, 195685, 195751, 195962, 200272, 202286, 207582, 208040, 211114, 218766, 224067, 229817, 230915, 238513, 248206, 267029];
$count=0;
foreach ($ids as $id) {
    $count++;
    if ($count < 60) {
        $jsonStr = c($id);
        try {
            $data = json_decode($jsonStr);
            $concats = $data[0];
            $member = $data[4];
            $level = $data[1];
            $main_pic = $data[3];
            $member->mark = "";
            save('memberby', $member);
            $level->uid = $member->uid;
            save('memberlevel', $level);
            foreach ($concats as $concat) {
                $concat->uid = $member->uid;
                echo "\n".$member->uid." ".$concat->type." ". $concat->number;
                save('membercontacts', $concat);
            }
        } catch (Exception $e) {
            echo "\n33333" . $e->getMessage();
        }
    }
}
