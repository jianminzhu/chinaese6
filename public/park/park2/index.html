<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <style>
        .bg {
            position: absolute;
        }

        .bg2 {
            width: 100%;
            height: 100%;
            background-position: 50%;
            background-repeat: no-repeat;
            background-size: cover;
            -webkit-print-color-adjust: exact;
        }

        * {
            margin: 0px;
            padding: 0px;
        }
    </style>
    <link rel="stylesheet" href="css/stylesheet.css"/>
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/moment.min.js"></script>
    <script src="js/d3/d3.v5.min.js"></script>
    <script src="js/sprite-vue.ext.js"></script>
    <script src="js/video.min.js"></script>
    <script src="carsRun.js?v=7"></script>
<body>
<img src="images/bg2.png?v=2" class="bg" style="z-index:1">
<div style="z-index: 99999;top: 570px;left: 69px;width: 1920px;height: 1075.69px;" class="bg">
    <video width="400" height="268" src="viedo/1.mp4" autoplay="autoplay" loop="loop"></video>
</div>
<div style="z-index: 99999;top: 570px;left: 491px;width: 1920px;height: 1075.69px;" class="bg">
    <video width="400" height="268" src="viedo/2.mp4" autoplay="autoplay" loop="loop"></video>
</div>
<div style="z-index: 99999;top: 570px;left: 913px;width: 1920px;height: 1075.69px;" class="bg">
    <video width="400" height="268" src="viedo/3.mp4" autoplay="autoplay" loop="loop"></video>
</div>
<div id="app" class="bg" style="z-index: 999">
    <scene :viewport="viewport" :resolution="resolution">

        <layer ref="layer">
            <group>
                <sprite :pos=[371,158] :attr='{textures:"images/map_bottom.png"}'></sprite>
                <sprite :pos=[434,147] :attr='{textures:"images/map_down.png"}'></sprite>
                <group v-for="(car,key,i) in cars">
                    <sprite :attrs="{id:car['id'],size:car['size'],pos:[car['pos'][0],car['pos'][1]],textures:car['textures']}"
                            ref="rcars"></sprite>
                </group>
                <sprite :pos='[434,147]' :attrs='{textures:"images/map_up.png"}'></sprite>
            </group>
            <s-label :attrs=date></s-label>
            <group v-for="line in lines" :pos="line['group']['pos']">
                <sprite :attrs=line['img'] ref="lines"></sprite>
                <s-label :attrs=line['line']></s-label>
                <s-label :attrs=line['site']></s-label>
            </group>
            <group>
                <s-label :pos="[3170,121]"
                         :attrs='{font:"60px manteka_cyrillicregular",fillColor:"#FF2B38",text:alarms["today"]["num"]}'></s-label>
                <s-label :pos="[3245,163]"
                         :attrs='{font:"24px RTWSYueRoudGoG0v1-Regular",fillColor:"#FF2B38",text:"次"}'></s-label>
                <s-label :pos="[3169,200]"
                         :attrs='{font:"21px MicrosoftYaHeiUI",fillColor:"#AE4446",text:"今日预警"}'></s-label>
                <s-label :pos="[2919,78]"
                         :attrs='{font:"49px manteka_cyrillicregular",fillColor:"#FFF",text:alarms["week"]["totalAlarmNum"]}'></s-label>
                <s-label :pos='[2929+(""+alarms["week"]["totalAlarmNum"]).length*30,93]'
                         :attrs='{font:"31px manteka_cyrillicregular",fillColor:"#6D7D9F",text:"次"}'></s-label>
            </group>
            <group :pos="weather['pos']">
                <sprite :attrs=weather['typeImg']></sprite>
                <sprite :attrs=weather['warning']></sprite>
                <s-label :attrs=weather['warningText']></s-label>
                <s-label :attrs=weather['temperature']></s-label>
                <s-label :attrs=weather['temperatureC']></s-label>
                <s-label :attrs=weather['type']></s-label>
                <s-label :attrs=weather['windDirect']></s-label>
                <s-label :attrs=weather['windDirectText']></s-label>
                <s-label :attrs=weather['windPower']></s-label>
                <s-label :attrs=weather['windPowerText']></s-label>
            </group>
            <group :pos="[2443,807]" :attrs="runingCarConfig" v-for="(carId,i) in runingIndx">
                <sprite :pos='[60,i*88+30]'
                        :attrs='{size:[50,50],textures:persons[runCars[carId]["personId"]]["img"]}'></sprite>
                <s-label :pos='[125,i*88+40]'
                         :attrs='{font:runingCarConfig["personName"]["font"],fillColor:runingCarConfig["personName"]["fillColor"],text:persons[runCars[carId]["personId"]]["name"] }'></s-label>
                <s-label :pos='[235,i*88+40]'
                         :attrs='{font:runingCarConfig["carNo"]["font"],fillColor:runingCarConfig["carNo"]["fillColor"],text:carId }'></s-label>
                <sprite :pos='[430,i*88+40]' :attrs='{textures:linesArr[runCars[carId]["lineNo"]]["img"]}'></sprite>
                <s-label :pos='[540,i*88+40]'
                         :attrs='{font:runingCarConfig["speed"]["font"],fillColor:runingCarConfig["speed"]["fillColor"],text:runCars[carId]["speed"] }'></s-label>
                <s-label :pos='[600,i*88+52]'
                         :attrs='{font:runingCarConfig["speedUnit"]["font"],fillColor:runingCarConfig["speedUnit"]["fillColor"],text:"KM"}'></s-label>
                <s-label :pos='[770,i*88+20]'
                         :attrs='{font:runingCarConfig["upDate"]["font"],fillColor:runingCarConfig["upDate"]["fillColor"],text:runCars[carId]["upDate"]}'></s-label>
                <s-label :pos='[750,i*88+49]'
                         :attrs='{font:runingCarConfig["upTime"]["font"],fillColor:runingCarConfig["upTime"]["fillColor"],text:runCars[carId]["upTime"]}'></s-label>
            </group>
            <group>
                <group :pos="[122,1425]" v-for="(yVal,i) in histogram['yArr']">
                    <s-label :pos='[-50,Math.floor(276*(1-yVal/histogram["yArr"][0]))]'
                             :attrs='{font:"18px STHeitiSC-Light",fillColor:"#61749C",text:yVal}'></s-label>
                </group>
                <group :pos="[122,1425]" v-for="(his,i) in histogram['values']">
                    <group :pos="[i*65,0]">
                        <sprite :pos='[10,220]'
                                :attrs='{ textures:histogram["conf"]["root"]+"/"+his["color"]+"/"+histogram["conf"]["bottom"]}'></sprite>
                        <sprite :pos='[20,280]'
                                :attrs='{ textures:histogram["conf"]["root"]+"/"+his["color"]+"/"+histogram["conf"]["foot"]}'></sprite>
                        <sprite :pos='[20,Math.floor(276*(his["value"]/histogram["yArr"][0]))-5]'
                                :attrs='{ textures:histogram["conf"]["root"]+"/"+his["color"]+"/"+histogram["conf"]["head"]}'></sprite>
                        <sprite :pos='[20,Math.floor(276*(his["value"]/histogram["yArr"][0]))+10]'
                                :attrs='{ size:[28,276*(1-his["value"]/histogram["yArr"][0])],textures:histogram["conf"]["root"]+"/"+his["color"]+"/"+histogram["conf"]["main"]}'></sprite>
                        <s-label :pos='[20,306]'
                                 :attrs='{font:"18px STHeitiSC-Light",fillColor:"#61749C",text:his["date"]}'></s-label>
                    </group>
                </group>
                <s-label :pos='[293,1760]'
                         :attrs='{font:"47px  manteka_cyrillicregular",fillColor:"#47D7C9",text:histogram["total"]}'></s-label>
                <!--manteka_cyrillicregular-->
                <s-label :pos='[histogram["total"].length*30 +293 ,1780]'
                         :attrs='{font:"23px RTWSYueRoudGoG0v1-Regular",fillColor:"#93C8DC",text:"公里"}'></s-label>
                <s-label :pos='[264,1809]'
                         :attrs='{font:"18px  STHeitiSC-Light",fillColor:"#748CBC",text:"上周累计"}'></s-label>
                <s-label :pos='[histogram["lastWeekTotal"].length*20 +264 ,1809]'
                         :attrs='{font:"18px  STHeitiSC-Light",fillColor:"#748CBC",text:histogram["lastWeekTotal"]+" 公里"}'></s-label>
            </group>
            <group :pos=[1344,1406]>
                <sprite :pos='[28,35]'
                        :attrs='{ textures: "images/charts/pie/"+Math.floor(logistics[0]["per"])+".png"}'></sprite>
                <s-label :pos='[68,40]'
                         :attrs='{font:"40px manteka_cyrillicregular",fillColor:"#FFF",text:logistics[0]["per"]}'></s-label>
                <s-label :pos='[118,55]'
                         :attrs='{font:"18px manteka_cyrillicregular",fillColor:"#FFF",text:"%"}'></s-label>
                <s-label :pos='[78,135]'
                         :attrs='{font:logisticsConf["name"]["font"],fillColor:logisticsConf["name"]["fillColor"],text:logistics[0]["name"]}'></s-label>
                <!--  <s-label :pos='[128,135]' :attrs='{font:logisticsConf["num"]["font"],fillColor:logisticsConf["num"]["fillColor"],text:logistics[0]["num"]}'></s-label>-->
                <sprite :pos='[256,35]'
                        :attrs='{ textures: "images/charts/pie/"+Math.floor(logistics[1]["per"])+".png"}'></sprite>
                <s-label :pos='[296,40]'
                         :attrs='{font:"40px manteka_cyrillicregular",fillColor:"#FFF",text:logistics[1]["per"]}'></s-label>
                <s-label :pos='[346,55]'
                         :attrs='{font:"18px manteka_cyrillicregular",fillColor:"#FFF",text:"%"}'></s-label>
                <s-label :pos='[296,135]'
                         :attrs='{font:logisticsConf["name"]["font"],fillColor:logisticsConf["name"]["fillColor"],text:logistics[1]["name"]}'></s-label>
                <!--  <s-label :pos='[356,135]' :attrs='{font:logisticsConf["num"]["font"],fillColor:logisticsConf["num"]["fillColor"],text:logistics[1]["num"]}'></s-label>-->


                <sprite :pos='[28,206]'
                        :attrs='{ textures: "images/charts/pie/"+Math.floor(logistics[2]["per"])+".png"}'></sprite>
                <s-label :pos='[68,211]'
                         :attrs='{font:"40px manteka_cyrillicregular",fillColor:"#FFF",text:logistics[2]["per"]}'></s-label>
                <s-label :pos='[118,225]'
                         :attrs='{font:"18px manteka_cyrillicregular",fillColor:"#FFF",text:"%"}'></s-label>
                <s-label :pos='[78,306]'
                         :attrs='{font:logisticsConf["name"]["font"],fillColor:logisticsConf["name"]["fillColor"],text:logistics[2]["name"]}'></s-label>
                <!--  <s-label :pos='[128,306]' :attrs='{font:logisticsConf["num"]["font"],fillColor:logisticsConf["num"]["fillColor"],text:logistics[2]["num"]}'></s-label>-->


                <sprite :pos='[256,206]'
                        :attrs='{ textures:"images/charts/pie/"+Math.floor(logistics[3]["per"])+".png"}'></sprite>
                <s-label :pos='[296,211]'
                         :attrs='{font:"40px manteka_cyrillicregular",fillColor:"#FFF",text:logistics[3]["per"]}'></s-label>
                <s-label :pos='[346,225]'
                         :attrs='{font:"18px manteka_cyrillicregular",fillColor:"#FFF",text:"%"}'></s-label>
                <s-label :pos='[296,306]'
                         :attrs='{font:logisticsConf["name"]["font"],fillColor:logisticsConf["name"]["fillColor"],text:logistics[3]["name"]}'></s-label>
                <!--  <s-label :pos='[356,306]' :attrs='{font:logisticsConf["num"]["font"],fillColor:logisticsConf["num"]["fillColor"],text:logistics[3]["num"]}'></s-label>-->
            </group>
            <group :pos="[1897,1451]" v-for="(hw,i) in huanWei">
                <sprite :attrs='{pos: [35, i*80],size: hw["hourSize"],bgcolor:"#42A6B3" }'></sprite>
                <sprite :attrs='{pos: [35,  i*80+25],size: hw["areaSize"],bgcolor:"#6AA3E4" }'></sprite>
                <s-label
                        :attrs='{pos:[-10,i*80-20] ,font:"30px manteka_cyrillicregular",fillColor:"#7E95C6" , text:hw["day"]}'></s-label>
                <s-label
                        :attrs='{pos:[-40,i*80+25],font:"18px STHeitiSC-Light",fillColor:"#7E95C6" ,text:hw["yearMonth"]}'></s-label>
                <s-label
                        :attrs='{pos:[384,i*80 ] ,font:"24px manteka_cyrillicregular",fillColor:"#42A6B3",text:hw["hour"]+"H"}'></s-label>
                <s-label
                        :attrs='{pos:[384,i*80+25] ,font:"24px manteka_cyrillicregular",fillColor:"#FFFFFF",text:hw["area"]+"㎡"}'></s-label>
            </group>
        </layer>
    </scene>
</div>
<span>
    <div style="position:absolute;left:400px;top:10px; z-index: 90000; font-size:1em;color:yellow;"><button
            data-opt-submit="">修正路径</button></div>
    <div id="msg"
         style="position:absolute;left:500px;top:10px; z-index: 90000; font-size:1em;color:yellow;">3采集中。。。</div>
</span>
</body>
<script>$(function () {
    function wait(ms) {
        return new Promise((resolve) => {
            setTimeout(resolve, ms)
        })
    }

    function genCarImgs(img) {
        let prefix = img.replace(/\d{1,2}\.png$/, "")
        return Array(12).fill(0).map((v, i) => {
            return {textures: `${prefix}${i + 1}.png`}
        })
    };
    let srcW = 3427;
    let srcH = 1920;
    let width = 1920;
    let resolution = [srcW, srcH]
    let carIds = Object.keys(carsRun);
    let scala = width / srcW;
    for (let i in carIds) {
        let pos = carsRun[carIds[i]];
        pos[0] = pos[0] * scala
        pos[1] = pos[1] * scala
        console.log("carIds ", carId)

    }
    $("body,body>svg,body>img,body>div").each(function () {
        $(this).addClass("bg").css({
            width: `${width}px`,
            height: `${srcH * scala}px`
        })
    })
    let today = {
        pos: [2074, 135],
        font: "38px Digital-7Mono",
        fillColor: "#42A6B3",
        text: moment().format('YYYY/MM/DD   HH:mm:ss')
    }
    cars = {
        car1: {
            id: "car1",
            pos: [carsRun["car1"][0]["x"], carsRun["car1"][0]["y"]],
            size: [120, 90],
            textures: "images/cars/violet/1.png"
        },
        car2: {
            id: "car2",
            pos: [carsRun["car2"][0]["x"], carsRun["car2"][0]["y"]],
            size: [120, 90],
            textures: "images/cars/blue/1.png"
        },
        car3: {
            id: "car3",
            pos: [carsRun["car3"][0]["x"], carsRun["car3"][0]["y"]],
            size: [120, 90],
            textures: "images/cars/pink/1.png"
        },
        car4: {
            id: "car4",
            pos: [carsRun["car4"][0]["x"], carsRun["car4"][0]["y"]],
            size: [120, 90],
            textures: "images/cars/green/1.png"
        },
    }
    scaleSize = function (dataset, index, type, height, scala = [0, 250]) {
        let hourMaxIndex = d3.scan(dataset, function (a, b) {
            return b[type] - a[type]
        });
        let scale = d3.scaleLinear()
            .domain([0, dataset[hourMaxIndex][type]])
            .range(scala);
        return [scale(dataset[index][type]), height]
    }

    huanWeiData = Array(4).fill(0).map((v, i) => {
        let hour = 3 + Math.floor(9 * Math.random());
        return {hour: hour, area: Math.floor(hour * ((Math.random()) * 300))}
    })
    var now = moment()
    huanWei = huanWeiData.map(function (it, index) {
        var date = now.add(-1 * index, 'days')
        return {
            day: date.format("DD"),
            yearMonth: date.format("YYYY/MM"),
            hour: it["hour"],
            area: it["area"],
            hourSize: scaleSize(huanWeiData, index, "hour", 11),
            areaSize: scaleSize(huanWeiData, index, "area", 5),
        };
    });


    histogram = {
        conf: {
            root: "images/charts/histogram",
            head: "head.png",
            foot: "foot.png",
            bottom: "bottom.png",
            main: "main.png"
        },
        yArr: [600, 500, 400, 300, 200, 100, 0],
        values: [
            {color: "blue", date: "4/11", value: 367}
            , {color: "blue", date: "4/12", value: 590}
            , {color: "blue", date: "4/13", value: 322}
            , {color: "blue", date: "4/14", value: 419}
            , {color: "blue", date: "4/15", value: 530}
            , {color: "blue", date: "4/16", value: 98}
            , {color: "pink", date: "4/17", value: 200}
        ],
        total: "" + (367 + 590 + 322 + 419 + 530 + 98 + 200),
        lastWeekTotal: "2658"
    }
    linesArr = {
        "1": {img: "images/lines/line1.png", siteNum: 9, name: "1号线"},
        "2": {img: "images/lines/line2.png", siteNum: 4, name: "2号线"},
        "3": {img: "images/lines/line3.png", siteNum: 8, name: "3号线"},
        "4": {img: "images/lines/line4.png", siteNum: 6, name: "4号线"},
        "5": {img: "images/lines/line5.png", siteNum: 5, name: "5号线"},
        "6": {img: "images/lines/line6.png", siteNum: 11, name: "6号线"}
    }
    persons = {
        "ls": {name: "小韩", img: "images/persons/ls.png"},
        "xb": {name: "小张", img: "images/persons/xb.png"},
        "xz": {name: "小李", img: "images/persons/xz.png"},
        "ss": {name: "小王", img: "images/persons/ss.png"}
    }
    runCars = {
        "B100801": {
            cardNo: "B100801",
            personId: "ls",
            lineNo: "4",
            speed: " 32",
            upDate: "2019/04/26",
            upTime: "18:35:00"
        },
        "B100802": {
            cardNo: "B100802",
            personId: "xb",
            lineNo: "3",
            speed: "  0",
            upDate: "2019/04/26",
            upTime: "18:35:00"
        },
        "B100808": {
            cardNo: "B100808",
            personId: "xz",
            lineNo: "5",
            speed: " 26",
            upDate: "2019/04/26",
            upTime: "18:35:00"
        },
        "B100809": {
            cardNo: "B100809",
            personId: "ss",
            lineNo: "6",
            speed: " 60",
            upDate: "2019/04/26",
            upTime: "18:35:00"
        },
        "B100812": {
            cardNo: "B100812",
            personId: "ls",
            lineNo: "1",
            speed: " 16",
            upDate: "2019/04/26",
            upTime: "18:35:00"
        }
    }
    logisticsConf = {
        name: {font: "18px Adobe Heiti Std R", fillColor: "#7E95C6"},
        num: {font: "28px manteka_cyrillicregular", fillColor: "#FFF"}
    }
    logistics = [
        {per: 30, name: "服装　", num: 3344},
        {per: 10, name: "纪念品", num: 1120},
        {per: 20, name: "生活用品", num: 10028},
        {per: 40, name: "饮料　", num: 16998},
    ]
    alarms = {
        today: {num: " 6"},
        week: {totalAlarmNum: 10+Math.floor(Math.random()*70)}
    }
    weather = {
        pos: [79, 631],
        temperature: {pos: [123, 85], text: "16", font: '30px bold manteka_cyrillicregular', fillColor: "#FFF"},
        temperatureC: {pos: [160, 85], text: "℃", font: '30px  ArialMT', fillColor: "#AAC2EC"},
        type: {pos: [123, 155], text: "大雨", font: '30px bold manteka_cyrillicregular', fillColor: "#FFF"},
        typeImg: {pos: [48, 145], textures: "images/weather/weather_bigRain.png"},
        windDirect: {pos: [125, 220], font: '12px "Adobe Heiti Std R"', fillColor: "#AAC2EC", text: "风向:"},
        windDirectText: {pos: [125, 240], font: '20px  Adobe Heiti Std R', fillColor: "#FFF", text: "东南"},
        windPower: {pos: [175, 220], font: '12px "Adobe Heiti Std R"', fillColor: "#AAC2EC", text: "风力:"},
        windPowerText: {pos: [175, 240], font: '20px  Adobe Heiti Std R', fillColor: "#FFF", text: "9级"},
        warning: {pos: [55, 315], textures: "images/weather/台风预警.png"},
        warningText: {pos: [45, 365], text: "台风预警", font: '16px "MicrosoftYaHeiUI"', fillColor: "#AAC2EC"},
    }
    data = {
        resolution: resolution,
        viewport: [srcW / (srcW / width), srcH / (srcW / width)],
        runingCarConfig: {
            personName: {font: "24px MicrosoftYaHeiUI", fillColor: "#FFF"},
            carNo: {font: "30px manteka_cyrillicregular", fillColor: "#FFF"},// STHeitiSC-Medium
            speed: {font: "36px manteka_cyrillicregular", fillColor: "#45C9C7"},
            speedUnit: {font: "21px STHeitiSC-Light", fillColor: "#6B7CA0"},
            upDate: {font: "20px ArialMT", fillColor: "#6B7CA0"},
            upTime: {font: "33px Digital-7Mono", fillColor: "#9BAFDB"},
        },
        runingIndx: ["B100801", "B100802", "B100808", "B100809", "B100812"],
        runCars,
        persons,
        linesArr,
        huanWei,
        histogram,
        logisticsConf,
        logistics,
        alarms,
        date: today,
        weather,

        lines: [
            {
                group: {pos: [80, 198]},
                img: {pos: [40, 80], id: "line6", textures: 'images/lines/line6.png'},
                line: {pos: [76, 80], font: '27px bold MicrosoftYaHeiUI-Bold', fillColor: "#FFF", text: " 8号线路"},
                site: {pos: [200, 86], font: "18px bold  MicrosoftYaHeiUILight", fillColor: "#B5CFFF", text: "10站"}
            }, {
                group: {pos: [80, 238]},
                img: {pos: [40, 80], id: "line2", textures: 'images/lines/line2.png'},
                line: {pos: [76, 80], font: '27px bold MicrosoftYaHeiUI-Bold', fillColor: "#FFF", text: "19号线路"},
                site: {pos: [200, 86], font: "18px bold  MicrosoftYaHeiUILight", fillColor: "#B5CFFF", text: " 8站"}
            }, {
                group: {pos: [80, 278]},
                img: {pos: [40, 80], id: "line3", textures: 'images/lines/line3.png'},
                line: {pos: [76, 80], font: '27px bold MicrosoftYaHeiUI-Bold', fillColor: "#FFF", text: "10号线路"},
                site: {pos: [200, 86], font: "18px bold  MicrosoftYaHeiUILight", fillColor: "#B5CFFF", text: " 2站"}
            }, {
                group: {pos: [80, 318]},
                img: {pos: [40, 80], id: "line4", textures: 'images/lines/line4.png'},
                line: {pos: [76, 80], font: '27px bold MicrosoftYaHeiUI-Bold', fillColor: "#FFF", text: " 6号线路"},
                site: {pos: [200, 86], font: "18px bold  MicrosoftYaHeiUILight", fillColor: "#B5CFFF", text: " 9站"}
            }, {
                group: {pos: [80, 358]},
                img: {pos: [40, 80], id: "line4", textures: 'images/lines/line4.png'},
                line: {pos: [76, 80], font: '27px bold MicrosoftYaHeiUI-Bold', fillColor: "#FFF", text: "11号线路"},
                site: {pos: [200, 86], font: "18px bold  MicrosoftYaHeiUILight", fillColor: "#B5CFFF", text: " 6站"}
            }, {
                group: {pos: [80, 398]},
                img: {pos: [40, 80], id: "line6", textures: 'images/lines/line6.png'},
                line: {pos: [76, 80], font: '27px bold MicrosoftYaHeiUI-Bold', fillColor: "#FFF", text: "12号线路"},
                site: {pos: [200, 86], font: "18px bold  MicrosoftYaHeiUILight", fillColor: "#B5CFFF", text: " 9站"}
            }, {
                group: {pos: [80, 438]},
                img: {pos: [40, 80], id: "line1", textures: 'images/lines/line1.png'},
                line: {pos: [76, 80], font: '27px bold MicrosoftYaHeiUI-Bold', fillColor: "#FFF", text: "1号线路"},
                site: {pos: [200, 86], font: "18px bold  MicrosoftYaHeiUILight", fillColor: "#B5CFFF", text: " 6站"}
            }, {
                group: {pos: [80, 478]},
                img: {pos: [40, 80], id: "line5", textures: 'images/lines/line5.png'},
                line: {pos: [76, 80], font: '27px bold MicrosoftYaHeiUI-Bold', fillColor: "#FFF", text: "2号线路"},
                site: {pos: [200, 86], font: "18px bold  MicrosoftYaHeiUILight", fillColor: "#B5CFFF", text: " 9站"}
            }]
    };
    m = new Vue({
        el: "#app",
        data() {
            return data;
        },
        mounted: function () {
            for (const car of this.$refs["rcars"]) {
                setTimeout(function () {
                    car.animate(genCarImgs(car.textures[0].src), {
                        duration: 1000,
                        iterations: Infinity,
                        direction: 'alternate',
                    });
                }, 1000 * Math.random());


            }
            let count = 0
            setInterval(function () {
                if (count > 300) {
                    count = 0;
                }
                count += 1;
                for (const carId of Object.keys(cars)) {
                    let srcCar = cars[carId];
                    let carPath = carsRun[srcCar.id];
                    let {x, y} = carPath[count % carPath.length];
                    cars[carId].pos[0] = x
                    cars[carId].pos[1] = y
                }
            }, 300)
        },
        methods: {}
    })
    setInterval(function () {
        try {
            weather["temperature"]["text"] = 10 + Math.floor(28 * Math.random())
            let num = 2+ Math.floor(68 * Math.random());
            alarms.today.num = num < 10 ? " " + num : num;
            alarms.week.totalAlarmNum = num+ Math.floor(Math.random()*70); 
            let total = 0;
            for (const his of histogram["values"]) {
                let kNumber = Math.floor(Number(histogram["yArr"][0]) * Math.random());
                total += kNumber
                his["value"] = kNumber
            }
            histogram.total = total + ""

        } catch (e) {
        }
    }, 1000)
    setInterval(function () {
        try {
            for (const his of logistics) {
                let per = Math.floor(100 * Math.random())
                if (per > 90) {
                    per = 90
                }
                his["per"] = per
            }
        } catch (e) {
        }
    }, 1000)

    setInterval(function () {
        today["text"] = moment().format('YYYY/MM/DD   HH:mm:ss')
    }, 1000)
    setInterval(function () {
        var carNos = Object.keys(runCars);
        let now = moment();
        let date = now.format("YYYY/MM/DD")
        let time = now.format("hh:mm:ss")

        function upCar(car) {
            let speed = Math.abs(Math.floor(Number(car["speed"]) + Math.ceil((Math.random() > 0.5 ? -1 : 1) * 10 * Math.random())));
            if (speed > 100) {
                speed = Math.floor(100 - 10 * Math.random());
            }
            car["speed"] = speed
            car['upDate'] = date;
            car['upTime'] = time;
        }

        for (const carNo of carNos) {
            let car = runCars[carNo]
            setTimeout(function () {
                upCar(car);
            }, Math.ceil(5000 * Math.random()))
        }
    }, 2000)
    // setInterval(function () {
    //         var a=m.$refs.rcars[0]
    //         let car = cars["car1"];
    //         var index=car["index"]||1
    //         if (index > 100) {
    //             index = 0;
    //         }
    //         var pos= a.attr().pos
    //         a.attr({pos: [++pos[0],++pos[1]],textures : `0${index++%10}.png`})
    //
    //     console.log( car["textures"]);
    // }, 300)


    // a=m.$refs.rcars[0]
    // rangeGen=function(start, end, fun) {
    //     return Array(end - start + 1).fill(0).map((v, i) => fun(i + start))
    // }
    // a.animate(rangeGen(1, 12, function (i) {
    //     var color = "violet";
    //     return {"textures":`images/cars/${color}/quan_${color}_${i<10?"0":""}${i}.png`};
    // }, {
    //     duration: 500,
    //     direction: 'alternate',
    //     iterations: Infinity,
    // }));

    setInterval(function () {
        let data = Array(4).fill(0).map((v, i) => {
            let hour = 3 + Math.floor(9 * Math.random());
            return {hour: hour, area: Math.floor(hour * ((Math.random()) * 300))}
        })
        var a = data.map(function (it, index) {
            let hw = huanWei[index];
            console.log(hw)
            hw.area = d3.format("4.3d")(Math.random() * 1000)
            hw.hour = 1 + Math.floor(Math.random() * 12);
            hw.hourSize = scaleSize(data, index, "hour", 11);
            hw.areaSize = scaleSize(data, index, "area", 5);
        });
    }, 2000)
    setTimeout(function () {
        let car1 = cars["car1"];
        let pos = car1.pos;
        car1.pos = [pos[0] + 50, pos[1] + 50]
    }, 1000)


})
</script>
<script>

    var jmsg = $("#msg");
    let items = [];
    isRun = false;
    let carId = 1;
    $("body").mousemove(function (e) {
        if (isRun) {
            var x = e.pageX;
            var y = e.pageY;
            var t = new Date().getTime();
            let d = {x, y, t};
            items.push(d)
        }
    });
    allCar = {};
    $("body").click(function () {
        isRun = !isRun;
        $("#msg").html(isRun ? carId + "采集中。。。" : "处理中");
        if (isRun == false) {
            console.log(items[0]);
            let car = `car${carId}`;
            allCar[car] = items;
            items = [];
            $("#msg").html(carId + "处理完毕");
            carId++

        }
    })
    $("[data-opt-submit]").click(function () {
        $.ajax({
            url: "/index.php/index/addr/carsRun"
            , method: "post"
            , data: {jsonStr: JSON.stringify(allCar)}
        }).then(function () {
            jmsg.html("addSucc")
        })
        return false
    });
    $(function () {
        $("video").each(function () {
            $(this)[0].ready(function () {
                var myPlayer = this;
                myPlayer.play();
            });

        })
    })
</script>
</html>